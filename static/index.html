<html>
<head>
   <title>Tuppen</title>    
   <link rel="stylesheet" type="text/css" href="cards.css" media="screen" />
   <style>
       .player {
           height: 120px;
           padding: 5px;
       }
       .ankart {
           background-color: greenyellow;
       }
   </style>
   <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <p>
    <input type="text" id="idPlayer">
    <button onClick="startGame(document.getElementById('idPlayer').value)">Spielen</button>
    </p>

    <div id="gameTable"></div>

    <script>
        var gameTable = document.getElementById("gameTable");


        var addHeaders = {
            headers: {
                idPlayer: '',
            }
        }

        function startGame(idPlayer) {
            addHeaders.headers.idPlayer = idPlayer;

            setInterval(
            axios.get('/game', addHeaders)
                .then(function (response) {
                    console.log(response);
                    gameTable.innerHTML = '';
                    // handle success
                    response.data.forEach(function(player) {
                        var playerDiv = document.createElement("div");
                        playerDiv.classList.add("playingCards");
                        playerDiv.classList.add("player");
                        playerDiv.setAttribute("id", player.id);

                        if (player.hasAnCard) {
                            playerDiv.classList.add("ankart");
                        }

                        var tableUl = document.createElement("ul");
                        tableUl.classList.add("table");
                        
                        player.hand.forEach(function(card) {
                            if (card.suit == '*') {
                                var cardDiv = document.createElement("div");
                                cardDiv.classList.add("card");
                                cardDiv.classList.add("back");
                                cardDiv.innerHTML = '*';
                            }
                            else {
                                var cardDiv = document.createElement("a");
                                cardDiv.classList.add("card");
                                cardDiv.classList.add("rank-" + card.rank);
                                cardDiv.classList.add(card.suit);
                                cardDiv.setAttribute("id", card.id);
                                cardDiv.addEventListener('click', playCard, false);
                                
                                var rankSpan = document.createElement("span");
                                rankSpan.classList.add("rank");
                                rankSpan.innerHTML = card.rank;
                                
                                var suitSpan = document.createElement("span");
                                suitSpan.classList.add("suit");
                                suitSpan.innerHTML = '&' + card.suit + ';';
                                
                                cardDiv.appendChild(rankSpan);
                                cardDiv.appendChild(suitSpan);                                
                            }
                            var cardLi = document.createElement("li");
                            cardLi.appendChild(cardDiv);

                            tableUl.appendChild(cardLi);

                        });

                        playerDiv.appendChild(tableUl);
                        gameTable.appendChild(playerDiv);
                    });
                }
            ), 5000);
        }

        function playCard(e) {
            axios.get('/play?idCard=' + this.id, addHeaders)
                .then(function (response) {
                    //console.log(response);
                }
            );            
        }


    </script>
</body>
</html>